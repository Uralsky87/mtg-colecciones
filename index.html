<!DOCTYPE html>
<html lang="es" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <title>ManaCodex</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <link rel="stylesheet" href="styles.css?v=20260113i" />
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#f4f6fb">
<link rel="apple-touch-icon" href="icons/icon-192.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
</head>
<body>

  <!-- Banner de actualización -->
  <div id="updateBanner" class="update-banner hidden">
    <div class="update-content">
      <span class="update-text">¡Nueva versión disponible!</span>
      <button id="btnActualizarApp" class="btn-actualizar">Actualizar ahora</button>
      <button id="btnCerrarUpdate" class="btn-cerrar-update">×</button>
    </div>
  </div>

  <!-- =======================
       PANTALLA: BIENVENIDA
  ======================= -->
  <section id="pantallaInicio" class="pantalla active">
    <img src="icons/manacodex.png" alt="ManaCodex" class="logo-inicio" />
    <button id="btnEntrar" class="btn-principal">Entrar</button>
  </section>

  <!-- =======================
       PANTALLA: MENÚ PRINCIPAL
  ======================= -->
  <section id="pantallaMenu" class="pantalla">
    <img src="icons/manacodex.png" alt="ManaCodex" class="logo-menu" />
    <div class="menu">
      <button class="btn-menu" data-pantalla="colecciones">Colecciones</button>
      <button class="btn-menu" data-pantalla="buscar">Buscar</button>
      <button class="btn-menu" data-pantalla="decks">Decks</button>
      <button class="btn-menu" data-pantalla="estadisticas">Estadísticas</button>
      <button class="btn-menu" data-pantalla="cuenta">Cuenta</button>
    </div>
  </section>

  <!-- =======================
       PANTALLA: LISTA COLECCIONES
  ======================= -->
  <section id="pantallaColecciones" class="pantalla">
    <div class="topbar">
      <img src="icons/flecharegresar.png" class="btn-back" data-action="volverMenu" aria-label="Volver al menú" alt="Volver" />
      <h2>Colecciones</h2>
    </div>

    <div class="card">
      <label for="inputBuscarColecciones">Buscar colección:</label>

      <div class="fila fila-busqueda">
        <input id="inputBuscarColecciones" type="text" placeholder="Ej: Dominaria, Ixalan, Modern..." />
        <button id="btnLimpiarColecciones" class="btn-secundario" type="button" title="Limpiar">✕</button>
      </div>

      <small class="hint">Filtra por nombre (según escribes).</small>

      <div class="mostrar-como-container">
        <span class="mostrar-como-label">Mostrar como:</span>
        <label class="mostrar-como-item">
          <input type="radio" name="vistaColecciones" value="simbolo" id="vistaSimbolos" checked>
          <span>Símbolo de expansión</span>
        </label>
        <label class="mostrar-como-item">
          <input type="radio" name="vistaColecciones" value="lista" id="vistaLista">
          <span>Lista</span>
        </label>
      </div>
    </div>

    <!-- Menú desplegable de filtros -->
    <div class="filtro-desplegable-container">
      <button id="btnToggleFiltroTipos" class="btn-filtro-header" type="button">
        <span>Filtrar por tipo</span>
        <span class="arrow">▼</span>
      </button>
      
      <div id="filtroTiposContent" class="filtro-content hidden">
        <div class="filtro-actions">
          <button id="btnMarcarTodos" class="btn-filtro-action" type="button">✓ Marcar todos</button>
          <button id="btnDesmarcarTodos" class="btn-filtro-action" type="button">✕ Desmarcar todos</button>
        </div>
        
        <div class="filtro-checks">
          <label class="filtro-check-item">
            <input type="checkbox" class="chk-tipo-set" value="expansion" checked>
            <span>Expansiones</span>
          </label>
          <label class="filtro-check-item">
            <input type="checkbox" class="chk-tipo-set" value="core" checked>
            <span>Core</span>
          </label>
          <label class="filtro-check-item">
            <input type="checkbox" class="chk-tipo-set" value="commander" checked>
            <span>Commander</span>
          </label>
          <label class="filtro-check-item">
            <input type="checkbox" class="chk-tipo-set" value="masters" checked>
            <span>Masters</span>
          </label>
          <label class="filtro-check-item">
            <input type="checkbox" class="chk-tipo-set" value="promo" checked>
            <span>Promos</span>
          </label>
          <label class="filtro-check-item">
            <input type="checkbox" class="chk-tipo-set" value="token" checked>
            <span>Tokens</span>
          </label>
          <label class="filtro-check-item">
            <input type="checkbox" class="chk-tipo-set" value="memorabilia" checked>
            <span>Arte / Memorabilia</span>
          </label>
          <label class="filtro-check-item">
            <input type="checkbox" class="chk-tipo-set" value="other" checked>
            <span>Otros</span>
          </label>
          <label class="filtro-check-item">
            <input type="checkbox" id="chkMostrarOcultas" value="hidden">
            <span>Ocultas</span>
          </label>
        </div>
      </div>
    </div>

    <div id="listaColecciones"></div>
  </section>

  <!-- =======================
       PANTALLA: SET (CARTAS DE UNA COLECCIÓN)
  ======================= -->
  <section id="pantallaSet" class="pantalla">
    <div class="topbar topbar-set">
      <img src="icons/flecharegresar.png" class="btn-back" data-action="volverColecciones" aria-label="Volver a colecciones" alt="Volver" />
      <h2 id="tituloSet">Set</h2>

      <div class="set-actions">
        <!-- Toggle de idioma eliminado - ahora se manejan ambos idiomas simultáneamente -->
        
        <button id="btnActualizarPrecios" class="btn-secundario" type="button"
                title="Vuelve a descargar este set para refrescar precios">
          ⟳ Precios
        </button>
      </div>
    </div>

    <div id="progresoSet" class="progreso-box"></div>

    <div class="card">
      <label for="inputBuscarEnSet">Buscar carta en este set:</label>

      <div class="fila fila-busqueda">
        <input id="inputBuscarEnSet" type="text" placeholder="Ej: Bolt, Angel, Duress..." />
        <button id="btnLimpiarBuscarEnSet" class="btn-secundario" type="button" title="Limpiar">✕</button>
      </div>

      <div style="display:flex; gap:16px; flex-wrap:wrap; margin-top:10px;">
        <label class="chkline">
          <input id="chkSoloFaltanSet" type="checkbox" />
          Solo faltan
        </label>
        <label class="chkline">
          <input id="chkVerCartasMovil" type="checkbox" checked />
          Ver cartas
        </label>
        <label class="chkline">
          <input id="chkOcultarColeccion" type="checkbox" />
          Ocultar colección
        </label>
      </div>
    </div>

    <!-- Desplegable Autocompletar colección -->
    <div class="filtro-desplegable-container">
      <button id="btnToggleAutocompletar" class="btn-filtro-header" type="button">
        <span>Autocompletar colección</span>
        <span class="arrow">▼</span>
      </button>
      
      <div id="autocompletarContent" class="filtro-content hidden">
        <!-- Checkboxes Marcar/Desmarcar todas -->
        <div class="filtro-actions">
          <button id="btnMarcarTodasSet" class="btn-filtro-action" type="button">✓ Marcar todas</button>
          <button id="btnDesmarcarTodasSet" class="btn-filtro-action" type="button">✕ Desmarcar todas</button>
        </div>
        
        <!-- Input de rangos -->
        <div style="margin-top: 12px;">
          <label for="inputRangosCartas" style="display: block; margin-bottom: 6px; font-weight: 600; font-size: 14px;">
            Indica que cartas añadir:
          </label>
          <input 
            id="inputRangosCartas" 
            type="text" 
            placeholder="Ej: 1,2,4,8-12,16"
            style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid var(--border);"
          />
          <small class="hint" style="display: block; margin-top: 4px; font-size: 12px;">
            Puedes usar comas (1,2,3) y rangos (8-12)
          </small>
        </div>
        
        <!-- Botón Añadir -->
        <button id="btnAplicarRangos" class="btn-principal" type="button" style="width: 100%; margin-top: 12px;">
          Añadir
        </button>
      </div>
    </div>

    <div id="listaCartasSet"></div>
  </section>

  <!-- =======================
       PANTALLA: BUSCAR
  ======================= -->
  <section id="pantallaBuscar" class="pantalla">
    <div class="topbar">
      <img src="icons/flecharegresar.png" class="btn-back" data-action="volverMenu" aria-label="Volver al menú" alt="Volver" />
      <h2>Buscar</h2>
    </div>

    <div class="card">
      <label for="inputBuscar">Nombre de carta:</label>
      <div class="fila">
        <input id="inputBuscar" type="text" placeholder="Ej: Lightning Bolt" />
        <button id="btnBuscar" class="btn-principal" type="button">Buscar</button>
      </div>
      <small class="hint">Puedes escribir solo una parte del nombre.</small>
    </div>

    <div id="resultadosBuscar"></div>
  </section>

    <!-- =======================
       PANTALLA: DECKS
  ======================= -->
  <section id="pantallaDecks" class="pantalla">
    <div class="topbar">
      <img src="icons/flecharegresar.png" class="btn-back" data-action="volverMenu" aria-label="Volver al menú" alt="Volver" />
      <h2>Decks</h2>
    </div>

    <div id="listaDecks"></div>

    <div class="card">
      <button id="btnAgregarDeck" class="btn-principal" type="button" style="width: 100%;">+ Agregar Deck</button>
    </div>
  </section>

  <!-- Modal Agregar Deck -->
  <div id="modalAgregarDeck" class="modal-overlay" style="display:none;">
    <div class="modal-content">
      <h3>Agregar Deck</h3>
      
      <label for="inputNombreDeck">Nombre del Deck:</label>
      <input id="inputNombreDeck" type="text" placeholder="Ej: Mi Mazo Commander" />
      
      <label for="textareaListaDeck" style="margin-top: 15px;">Lista de cartas (formato Moxfield):</label>
      <textarea id="textareaListaDeck" rows="10" placeholder="1 Argonath, Pillars of the Kings (LTC) 351&#10;1 Sol Ring (C21) 263&#10;..." style="width: 100%; font-family: monospace; font-size: 0.9rem;"></textarea>
      
      <div id="mensajeCargandoDeck" style="display: none; margin-top: 15px; padding: 12px; background: #e3f2fd; border-radius: 8px; text-align: center; color: #1976d2;">
        <strong>⏳ Verificando cartas...</strong><br>
        <small>Esto puede tardar unos segundos</small>
      </div>
      
      <div style="display: flex; gap: 10px; margin-top: 20px;">
        <button id="btnGuardarDeck" class="btn-principal">Guardar</button>
        <button id="btnCancelarDeck" class="btn-secundario">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- Pantalla Ver Deck -->
  <section id="pantallaVerDeck" class="pantalla">
    <div class="topbar">
      <img src="icons/flecharegresar.png" class="btn-back" data-action="volverDecks" aria-label="Volver" alt="Volver" />
      <h2 id="tituloVerDeck">Deck</h2>
    </div>

    <div class="card">
      <div id="resumenDeck" class="hint"></div>
      <div style="display: flex; gap: 10px; align-items: center; margin-top: 15px; flex-wrap: wrap;">
        <button id="btnActualizarDeck" class="btn-secundario" type="button">Revisar colección</button>
        <button id="btnCompletarMazo" class="btn-secundario" type="button">Completar mazo ❗</button>
      </div>
      <div id="mensajeCargandoDeck" style="display: none; margin-top: 15px; padding: 12px; background: #e3f2fd; border-radius: 8px; text-align: center; color: #1976d2;">
        <strong>⏳ Cargando información del deck...</strong><br>
        <small>Esto puede tardar unos segundos</small>
      </div>
      <div id="mensajeCompletandoMazo" style="display: none; margin-top: 15px; padding: 12px; background: #e3f2fd; border-radius: 8px; text-align: center; color: #1976d2;">
        <strong>⏳ Agregando cartas a la colección...</strong><br>
        <small>Esto puede tardar unos segundos</small>
      </div>
      <div id="mensajeCargandoImagenesDeck" style="display: none; margin-top: 15px; padding: 12px; background: #e3f2fd; border-radius: 8px; text-align: center; color: #1976d2;">
        <strong>⏳ Cargando imágenes...</strong><br>
        <small>Esto puede tardar unos segundos</small>
      </div>
    </div>

    <!-- Modo de visualización -->
    <div class="card">
      <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
        <div style="display: flex; gap: 10px; align-items: center;">
          <span style="font-weight: 600;">Vista:</span>
          <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
            <input type="radio" name="modoDeck" value="lista" id="radioModoDeckLista" checked>
            <span>Lista</span>
          </label>
          <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
            <input type="radio" name="modoDeck" value="imagenes" id="radioModoDeckImagenes">
            <span>Imágenes</span>
          </label>
        </div>
        <div style="display: flex; gap: 10px; align-items: center;">
          <span style="font-weight: 600;">Ordenar:</span>
          <select id="selectorOrdenDeck" style="padding: 5px 10px; border-radius: 6px; border: 1px solid #ccc;">
            <option value="default">Por defecto</option>
            <option value="tipo">Por tipo</option>
            <option value="cmc">Por coste (CMC)</option>
            <option value="color">Por color</option>
            <option value="nombre">Por nombre</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Leyenda de LEDs -->
    <div class="card">
      <h4 style="margin-top: 0; margin-bottom: 10px;">Leyenda</h4>
      <div style="display: flex; flex-direction: column; gap: 8px;">
        <div style="display: flex; align-items: center; gap: 10px;">
          <img src="icons/Ledazul.png" alt="" width="24" height="24">
          <span>En posesión</span>
        </div>
        <div style="display: flex; align-items: center; gap: 10px;">
          <img src="icons/Ledrojo.png" alt="" width="24" height="24">
          <span>Falta</span>
        </div>
        <div style="display: flex; align-items: center; gap: 10px;">
          <img src="icons/Ledvioleta.png" alt="" width="24" height="24">
          <span>En posesión en otro set</span>
        </div>
      </div>
    </div>

    <div class="card">
      <div id="listaCartasDeck"></div>
    </div>

    <div class="card">
      <div id="mensajeEliminandoCartas" style="display: none; margin-bottom: 15px; padding: 12px; background: #fff3cd; border-radius: 8px; text-align: center; color: #856404;">
        <strong>⏳ Verificando cartas para eliminar...</strong><br>
        <small>Esto puede tardar unos segundos</small>
      </div>
      <button id="btnEliminarDeck" class="btn-secundario" type="button" style="width: 100%; background: #dc3545;">Eliminar Deck</button>
    </div>
  </section>

    <!-- =======================
       PANTALLA: ESTADÍSTICAS
  ======================= -->
  <section id="pantallaEstadisticas" class="pantalla">
    <div class="topbar">
      <img src="icons/flecharegresar.png" class="btn-back" data-action="volverMenu" aria-label="Volver al menú" alt="Volver" />
      <h2>Estadísticas</h2>
    </div>

    <div class="card">
      <h3 style="margin-top:0;">Resumen</h3>
      <div id="statsResumen" class="hint">—</div>
      <div style="height:10px;"></div>
      <button id="btnStatsRecalcular" class="btn-secundario" type="button">Recalcular</button>
    </div>

    <div class="card">
      <h3 style="margin-top:0;">Sets</h3>
      <div id="statsSets" class="hint">—</div>
    </div>
  </section>

    <!-- =======================
       PANTALLA: CUENTA
  ======================= -->
  <section id="pantallaCuenta" class="pantalla">
    <div class="topbar">
      <img src="icons/flecharegresar.png" class="btn-back" data-action="volverMenu" aria-label="Volver al menú" alt="Volver" />
      <h2>Cuenta</h2>
    </div>

  <!-- (Tema eliminado: la aplicación usa tema claro por defecto) -->

    <!-- Login + Sync (ÚNICO, sin duplicados) -->
    <div class="card card-small">
      <h3 style="margin-top:0; font-size:1rem;">Cuenta y sincronización</h3>

      <div class="fila">
        <input id="inputEmail" type="text" placeholder="tu@email.com" />
        <button id="btnLogin" class="btn-principal" type="button">Entrar</button>
      </div>

      <div class="acciones-verticales" style="margin-top:10px;">
        <button id="btnPushNow" class="btn-secundario" type="button">Guardar</button>
        <button id="btnLogout" class="btn-secundario" type="button">Salir</button>
      </div>

      <p id="syncStatus" class="hint" style="margin-top:10px;"></p>
    </div>

    <!-- Backup JSON (ÚNICO, sin duplicados) -->
    <div class="card card-small">
      <h3 style="margin-top:0; font-size:1rem;">Copia de seguridad</h3>
      <p class="hint" style="font-size:0.85rem;">Exporta tu colección a un archivo JSON o impórtala desde uno.</p>

      <div class="acciones-verticales">
        <button id="btnExportarEstado" class="btn-principal" type="button">Exportar</button>
        <input id="inputImportarEstado" type="file" accept="application/json" style="display:none;" />
        <button id="btnImportarEstado" class="btn-secundario" type="button">Importar</button>
      </div>

      <p id="msgBackup" class="hint" style="margin-top:10px;"></p>
    </div>

    <!-- Catálogo de sets -->
    <div class="card card-small">
      <h3 style="margin-top:0; font-size:1rem;">Catálogo de sets</h3>
      <p class="hint" style="font-size:0.85rem;">Actualiza la lista de colecciones disponibles desde Scryfall.</p>

      <div class="acciones-verticales">
        <button id="btnActualizarCatalogo" class="btn-principal" type="button" style="width: 100%; padding: 14px; font-size: 1.1rem; cursor: pointer; border-radius: 10px; border: none; font-weight: bold; background: linear-gradient(180deg, rgba(122,166,255,.45), rgba(122,166,255,.18)) !important; border-color: rgba(122,166,255,.45) !important; box-shadow: 0 3px 8px rgba(47, 108, 255, 0.15), 0 1px 3px rgba(0, 0, 0, 0.08), inset 0 1px 0 rgba(255, 255, 255, 0.3) !important; color: var(--text) !important; transition: all 0.2s ease;">Actualizar catálogo</button>
      </div>

      <p id="msgCatalogo" class="hint" style="margin-top:10px;"></p>
      <p id="fechaCatalogo" class="hint" style="margin-top:5px; font-size:0.8rem; opacity:0.7;"></p>
    </div>

    <!-- Atribución Scryfall -->
    <div class="card" style="text-align:center; opacity:0.85;">
      <p class="hint" style="margin:0;">
        Datos de cartas proporcionados por Scryfall.<br>
        © Scryfall, LLC · <a href="https://scryfall.com" target="_blank" rel="noopener">scryfall.com</a>
      </p>
    </div>

    <!-- Versión de la app -->
    <div style="text-align:center; margin-top:20px; opacity:0.6;">
      <p class="hint" style="margin:0; font-size:0.75rem;">
        ManaCodex v0.71
      </p>
    </div>
 
  </section>

  <!-- =======================
       MODAL: CARTA
  ======================= -->
  <div id="modalCarta" class="modal hidden" role="dialog" aria-modal="true">
    <div class="modal-backdrop" data-action="cerrarModal"></div>

    <div class="modal-content">
      <div class="modal-topbar">
        <div id="modalCartaTitulo" class="modal-title">Carta</div>
        <button id="btnCerrarModal" class="btn-secundario" type="button">✕</button>
      </div>

      <div id="modalCartaBody" class="modal-body"></div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <!-- Botón flotante scroll to top (único y global) -->
  <button id="btnScrollTop" aria-label="Volver arriba">↑</button>

  <script src="app.js?v=20260113k4"></script>
</body>
</html>
