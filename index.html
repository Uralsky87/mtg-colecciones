<!DOCTYPE html>
<html lang="es" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <title>ManaCodex</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@400;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="./styles.css?v=0.82" />
  <link rel="manifest" href="manifest.webmanifest" />
  <meta name="theme-color" content="#f4f6fb" />
  <link rel="icon" href="icons/icon-192.png" type="image/png" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
</head>
<body>

  <!-- Banner de actualización -->
  <div id="updateBanner" class="update-banner hidden">
    <div class="update-content">
      <span class="update-text">¡Nueva versión disponible!</span>
      <button id="btnActualizarApp" class="btn-actualizar">Actualizar ahora</button>
      <button id="btnCerrarUpdate" class="btn-cerrar-update">×</button>
    </div>
  </div>

  <!-- =======================
       PANTALLA: MENÚ PRINCIPAL
  ======================= -->
  <section id="pantallaMenu" class="pantalla active">
    <div class="logo-menu logo-menu-text" role="img" aria-label="ManaCodex">
      <span class="logo-mana">Mana</span><span class="logo-codex">Codex</span>
    </div>
    <div class="menu">
      <button class="btn-menu" data-pantalla="colecciones">Colecciones</button>
      <button class="btn-menu" data-pantalla="buscar">Buscar</button>
      <button class="btn-menu" data-pantalla="comandantes">Comandantes</button>
      <button class="btn-menu" data-pantalla="estadisticas">Estadísticas</button>
      <button class="btn-menu" data-pantalla="cuenta">Cuenta</button>
      <button id="btnBuscarActualizaciones" class="btn-menu btn-actualizar">Comprobar actualizaciones</button>
    </div>
  </section>

  <!-- =======================
       PANTALLA: LISTA COLECCIONES
  ======================= -->
  <section id="pantallaColecciones" class="pantalla">
    <div class="topbar">
      <img src="icons/flecharegresar.png" class="btn-back" data-action="volverMenu" aria-label="Volver al menú" alt="Volver" />
      <h2>Colecciones</h2>
      <button id="btnOpcionesControles" class="btn-secundario btn-opciones" type="button">Opciones</button>
    </div>

    <div class="card">
      <label for="inputBuscarColecciones">Buscar colección:</label>

      <div class="fila fila-busqueda">
        <input id="inputBuscarColecciones" type="text" placeholder="Ej: Dominaria, Ixalan, Modern..." />
        <button id="btnLimpiarColecciones" class="btn-secundario" type="button" title="Limpiar">✕</button>
      </div>

      <small class="hint">Filtra por nombre (según escribes).</small>

      <div class="mostrar-como-container">
        <span class="mostrar-como-label">Mostrar como:</span>
        <label class="mostrar-como-item">
          <input type="radio" name="vistaColecciones" value="simbolo" id="vistaSimbolos" checked>
          <span class="label-desktop">Símbolo de expansión</span>
          <span class="label-mobile">Símbolo</span>
        </label>
        <label class="mostrar-como-item">
          <input type="radio" name="vistaColecciones" value="lista" id="vistaLista">
          <span>Lista</span>
        </label>
      </div>
    </div>

    <!-- Menú desplegable de filtros -->
    <div class="filtro-desplegable-container">
      <button id="btnToggleFiltroTipos" class="btn-filtro-header" type="button">
        <span>Filtrar por tipo</span>
        <span class="arrow">▼</span>
      </button>
      
      <div id="filtroTiposContent" class="filtro-content hidden">
        <div class="filtro-actions">
          <button id="btnMarcarTodos" class="btn-filtro-action" type="button">✓ Marcar todos</button>
          <button id="btnDesmarcarTodos" class="btn-filtro-action" type="button">✕ Desmarcar todos</button>
        </div>
        
        <div class="filtro-checks">
          <label class="filtro-check-item">
            <input type="checkbox" class="chk-tipo-set" value="expansion" checked>
            <span>Expansiones</span>
          </label>
          <label class="filtro-check-item">
            <input type="checkbox" class="chk-tipo-set" value="core" checked>
            <span>Core</span>
          </label>
          <label class="filtro-check-item">
            <input type="checkbox" class="chk-tipo-set" value="commander" checked>
            <span>Commander</span>
          </label>
          <label class="filtro-check-item">
            <input type="checkbox" class="chk-tipo-set" value="masters" checked>
            <span>Masters</span>
          </label>
          <label class="filtro-check-item">
            <input type="checkbox" class="chk-tipo-set" value="promo" checked>
            <span>Promos</span>
          </label>
          <label class="filtro-check-item">
            <input type="checkbox" class="chk-tipo-set" value="token" checked>
            <span>Tokens</span>
          </label>
          <label class="filtro-check-item">
            <input type="checkbox" class="chk-tipo-set" value="memorabilia" checked>
            <span>Arte / Memorabilia</span>
          </label>
          <label class="filtro-check-item">
            <input type="checkbox" class="chk-tipo-set" value="other" checked>
            <span>Otros</span>
          </label>
          <label class="filtro-check-item">
            <input type="checkbox" id="chkMostrarOcultas" value="hidden">
            <span>Ocultas</span>
          </label>
        </div>
      </div>
    </div>

    <div class="filtro-desplegable-container">
      <button id="btnToggleFiltroYearColecciones" class="btn-filtro-header" type="button">
        <span>Filtrar por año</span>
        <span class="arrow">▼</span>
      </button>
      
      <div id="filtroYearColeccionesContent" class="filtro-content hidden">
        <label for="selectFiltroYearColecciones" style="display: block; margin-bottom: 6px; font-weight: 600; font-size: 14px;">
          Selecciona el año
        </label>
        <select id="selectFiltroYearColecciones"></select>
      </div>
    </div>

    <div id="listaColecciones"></div>
  </section>

  <!-- Modal: Opciones de controles de cartas -->
  <div id="modalOpcionesControles" class="modal-overlay" style="display:none;">
    <div class="modal-content">
      <div class="modal-topbar">
        <div class="modal-title">Opciones de cartas</div>
        <button id="btnCerrarOpcionesControles" class="btn-secundario" type="button">Cerrar</button>
      </div>
      <div class="modal-body">
        <div class="hint" style="margin-bottom: 12px;">Cambios globales para todos los sets.</div>

        <div class="card opciones-section">
          <div class="subtitulo">Idioma visible</div>
          <div class="opciones-row">
            <label class="chkline">
              <input type="radio" name="modoIdiomaCartas" value="both" checked />
              Ambos
            </label>
            <label class="chkline">
              <input type="radio" name="modoIdiomaCartas" value="en" />
              Solo EN
            </label>
            <label class="chkline">
              <input type="radio" name="modoIdiomaCartas" value="es" />
              Solo ES
            </label>
          </div>
        </div>

        <div class="card opciones-section">
          <div class="subtitulo">Controles visibles</div>
          <div class="opciones-row">
            <label class="chkline">
              <input id="chkMostrarCantidad" type="checkbox" checked />
              Cantidad
            </label>
            <label class="chkline">
              <input id="chkMostrarFoil" type="checkbox" checked />
              Foil
            </label>
          </div>
        </div>

        <div class="card opciones-section">
          <div class="subtitulo">Contadores extra</div>
          <div id="listaContadoresOpciones" class="opciones-lista"></div>
          <div class="opciones-row" style="margin-top: 8px;">
            <input id="inputNuevoContador" type="text" placeholder="Nombre del contador" />
            <button id="btnAgregarContador" class="btn-secundario" type="button">Añadir</button>
          </div>
        </div>

        <div class="card opciones-section">
          <div class="subtitulo">Tags</div>
          <div id="listaTagsOpciones" class="opciones-lista"></div>
          <div class="opciones-row" style="margin-top: 8px;">
            <input id="inputNuevoTag" type="text" placeholder="Nombre del tag" />
            <button id="btnAgregarTag" class="btn-secundario" type="button">Añadir</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- =======================
       PANTALLA: SET (CARTAS DE UNA COLECCIÓN)
  ======================= -->
  <section id="pantallaSet" class="pantalla">
    <div class="topbar topbar-set">
      <img src="icons/flecharegresar.png" class="btn-back" data-action="volverColecciones" aria-label="Volver a colecciones" alt="Volver" />
      <h2 id="tituloSet">Set</h2>

      <div class="set-actions">
        <!-- Toggle de idioma eliminado - ahora se manejan ambos idiomas simultáneamente -->
        
        <button id="btnActualizarPrecios" class="btn-secundario" type="button"
                title="Vuelve a descargar este set para refrescar precios">
          ⟳ Precios
        </button>
      </div>
    </div>

    <div id="progresoSet" class="progreso-box"></div>

    <div class="card">
      <label for="inputBuscarEnSet">Buscar carta en este set:</label>

      <div class="fila fila-busqueda">
        <input id="inputBuscarEnSet" type="text" placeholder="Ej: Bolt, Angel, Duress..." />
        <button id="btnLimpiarBuscarEnSet" class="btn-secundario" type="button" title="Limpiar">✕</button>
      </div>

      <div style="display:flex; gap:16px; flex-wrap:wrap; margin-top:10px;">
        <label class="chkline">
          <input id="chkMostrarCartas" type="checkbox" checked />
          Mostrar cartas
        </label>
        <label class="chkline">
          <input id="chkOcultarColeccion" type="checkbox" />
          Ocultar colección
        </label>
      </div>
    </div>

    <!-- Desplegable de filtros (set) -->
    <div class="filtro-desplegable-container">
      <button id="btnToggleFiltrosSet" class="btn-filtro-header" type="button">
        <span>Filtros del set</span>
        <span class="arrow">▼</span>
      </button>
      
      <div id="filtrosSetContent" class="filtro-content hidden">
        <div class="filtro-checks">
          <label class="filtro-check-item">
            <input id="chkEnPosesionSet" type="checkbox" />
            <span>En posesión</span>
          </label>
          <label class="filtro-check-item">
            <input id="chkSoloFaltanSet" type="checkbox" />
            <span>En falta</span>
          </label>
        </div>

        <div style="margin-top: 12px;">
          <label class="filtro-check-item">
            <input id="chkFiltroColorSet" type="checkbox" />
            <span>Filtrar por color</span>
          </label>
          <div id="filtroColoresSet" class="filtro-checks hidden" style="margin-top: 8px;">
            <label class="filtro-check-item">
              <input type="checkbox" class="chk-color-set" value="W" />
              <span>Blanco</span>
            </label>
            <label class="filtro-check-item">
              <input type="checkbox" class="chk-color-set" value="U" />
              <span>Azul</span>
            </label>
            <label class="filtro-check-item">
              <input type="checkbox" class="chk-color-set" value="B" />
              <span>Negro</span>
            </label>
            <label class="filtro-check-item">
              <input type="checkbox" class="chk-color-set" value="R" />
              <span>Rojo</span>
            </label>
            <label class="filtro-check-item">
              <input type="checkbox" class="chk-color-set" value="G" />
              <span>Verde</span>
            </label>
            <label class="filtro-check-item">
              <input type="checkbox" class="chk-color-set" value="C" />
              <span>Incoloro</span>
            </label>
          </div>
        </div>

        <div style="margin-top: 12px;">
          <div class="hint" style="margin-bottom: 6px;">Rareza</div>
          <div class="filtro-checks">
            <label class="filtro-check-item">
              <input type="checkbox" class="chk-rareza-set" value="Común" checked />
              <span>Común</span>
            </label>
            <label class="filtro-check-item">
              <input type="checkbox" class="chk-rareza-set" value="Infrecuente" checked />
              <span>Infrecuente</span>
            </label>
            <label class="filtro-check-item">
              <input type="checkbox" class="chk-rareza-set" value="Rara" checked />
              <span>Rara</span>
            </label>
            <label class="filtro-check-item">
              <input type="checkbox" class="chk-rareza-set" value="Mítica" checked />
              <span>Mítica</span>
            </label>
          </div>
        </div>
      </div>
    </div>

    <!-- Desplegable Autocompletar colección -->
    <div class="filtro-desplegable-container">
      <button id="btnToggleAutocompletar" class="btn-filtro-header" type="button">
        <span>Autocompletar colección</span>
        <span class="arrow">▼</span>
      </button>
      
      <div id="autocompletarContent" class="filtro-content hidden">
        <!-- Checkboxes Marcar/Desmarcar todas -->
        <div class="filtro-actions">
          <button id="btnMarcarTodasSet" class="btn-filtro-action" type="button">✓ Marcar todas</button>
          <button id="btnDesmarcarTodasSet" class="btn-filtro-action" type="button">✕ Desmarcar todas</button>
        </div>
        
        <!-- Input de rangos -->
        <div style="margin-top: 12px;">
          <label for="inputRangosCartas" style="display: block; margin-bottom: 6px; font-weight: 600; font-size: 14px;">
            Indica que cartas añadir:
          </label>
          <input 
            id="inputRangosCartas" 
            type="text" 
            placeholder="Ej: 1,2,4,8-12,16"
            style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid var(--border);"
          />
          <small class="hint" style="display: block; margin-top: 4px; font-size: 12px;">
            Puedes usar comas (1,2,3) y rangos (8-12)
          </small>
        </div>
        
        <!-- Botón Añadir -->
        <button id="btnAplicarRangos" class="btn-principal" type="button" style="width: 100%; margin-top: 12px;">
          Añadir
        </button>
      </div>
    </div>

    <div id="listaCartasSet"></div>
  </section>

  <!-- =======================
       PANTALLA: BUSCAR
  ======================= -->
  <section id="pantallaBuscar" class="pantalla">
    <div class="topbar">
      <img src="icons/flecharegresar.png" class="btn-back" data-action="volverMenu" aria-label="Volver al menú" alt="Volver" />
      <h2>Buscar</h2>
    </div>

    <div class="card">
      <label for="inputBuscar">Nombre de carta:</label>
      <div class="fila">
        <input id="inputBuscar" type="text" placeholder="Ej: Lightning Bolt" />
        <button id="btnBuscar" class="btn-principal" type="button">Buscar</button>
      </div>
      <div class="opciones-row" style="margin-top: 8px;">
        <label class="chkline">
          <input id="chkBuscarExacta" type="checkbox" />
          <span>Palabra exacta</span>
        </label>
        <label class="chkline">
          <input id="chkBuscarVerImagenes" type="checkbox" />
          <span>Ver imagenes</span>
        </label>
      </div>
      <small class="hint">Puedes escribir solo una parte del nombre o activar “Palabra exacta”.</small>
    </div>

    <div id="resultadosBuscar"></div>
  </section>

  <!-- =======================
       PANTALLA: COMANDANTES
  ======================= -->
  <section id="pantallaComandantes" class="pantalla">
    <div class="topbar">
      <img src="icons/flecharegresar.png" class="btn-back" data-action="volverMenu" aria-label="Volver al menú" alt="Volver" />
      <h2>Comandantes</h2>
    </div>

    <div class="card commander-card">
      <h3 class="commander-title">Filtra para encontrar tu comandante</h3>

      <div class="filtro-bloque">
        <div class="filtro-label">Colores</div>
        <div class="mana-colores" role="group" aria-label="Filtros de color">
          <label class="mana-check mana-w">
            <input type="checkbox" class="chk-commander-color" value="w" />
            <span class="mana-icon mana-icon-w" aria-hidden="true">
              <svg class="mana-svg" viewBox="0 0 24 24" focusable="false" aria-hidden="true">
                <circle cx="12" cy="12" r="5" />
                <rect x="11" y="2" width="2" height="4" />
                <rect x="11" y="18" width="2" height="4" />
                <rect x="2" y="11" width="4" height="2" />
                <rect x="18" y="11" width="4" height="2" />
              </svg>
            </span>
            <span class="mana-label">Blanco</span>
          </label>

          <label class="mana-check mana-u">
            <input type="checkbox" class="chk-commander-color" value="u" />
            <span class="mana-icon mana-icon-u" aria-hidden="true">
              <svg class="mana-svg" viewBox="0 0 24 24" focusable="false" aria-hidden="true">
                <path d="M12 3c-2.5 3.6-5 6.4-5 9.2a5 5 0 0 0 10 0C17 9.4 14.5 6.6 12 3z" />
              </svg>
            </span>
            <span class="mana-label">Azul</span>
          </label>

          <label class="mana-check mana-b">
            <input type="checkbox" class="chk-commander-color" value="b" />
            <span class="mana-icon mana-icon-b" aria-hidden="true">
              <svg class="mana-svg" viewBox="0 0 24 24" focusable="false" aria-hidden="true">
                <circle cx="12" cy="10" r="6" />
                <rect x="7" y="14" width="10" height="6" rx="2" />
                <circle cx="9" cy="10" r="1.5" fill="#fff" />
                <circle cx="15" cy="10" r="1.5" fill="#fff" />
              </svg>
            </span>
            <span class="mana-label">Negro</span>
          </label>

          <label class="mana-check mana-r">
            <input type="checkbox" class="chk-commander-color" value="r" />
            <span class="mana-icon mana-icon-r" aria-hidden="true">
              <svg class="mana-svg" viewBox="0 0 24 24" focusable="false" aria-hidden="true">
                <path d="M12 3c1.6 2.2.8 4.2-1 5.8 3.6-.2 6 2 6 5.2 0 3-2.4 5-5.5 5S6 17 6 14.5C6 10.8 9.2 9 12 3z" />
              </svg>
            </span>
            <span class="mana-label">Rojo</span>
          </label>

          <label class="mana-check mana-g">
            <input type="checkbox" class="chk-commander-color" value="g" />
            <span class="mana-icon mana-icon-g" aria-hidden="true">
              <svg class="mana-svg" viewBox="0 0 24 24" focusable="false" aria-hidden="true">
                <circle cx="12" cy="9" r="5" />
                <rect x="11" y="13" width="2" height="7" />
              </svg>
            </span>
            <span class="mana-label">Verde</span>
          </label>

          <label class="mana-check mana-c">
            <input type="checkbox" id="chkCommanderColorless" value="c" />
            <span class="mana-icon mana-icon-c" aria-hidden="true">
              <svg class="mana-svg" viewBox="0 0 24 24" focusable="false" aria-hidden="true">
                <rect x="6" y="6" width="12" height="12" transform="rotate(45 12 12)" />
              </svg>
            </span>
            <span class="mana-label">Incoloro</span>
          </label>
        </div>
        <label class="chkline commander-exacto">
          <input id="chkCommanderExacto" type="checkbox" />
          <span>Solo identidad exacta</span>
        </label>
      </div>

      <div class="filtro-bloque">
        <div class="filtro-label">Coste de mana</div>
        <div id="manaRangoBar" class="mana-rango-bar" role="group" aria-label="Rango de coste de mana">
          <button class="mana-step" type="button" data-cmc="0">0</button>
          <button class="mana-step" type="button" data-cmc="1">1</button>
          <button class="mana-step" type="button" data-cmc="2">2</button>
          <button class="mana-step" type="button" data-cmc="3">3</button>
          <button class="mana-step" type="button" data-cmc="4">4</button>
          <button class="mana-step" type="button" data-cmc="5">5</button>
          <button class="mana-step" type="button" data-cmc="6">6</button>
          <button class="mana-step" type="button" data-cmc="7">7</button>
          <button class="mana-step" type="button" data-cmc="8">8</button>
          <button class="mana-step" type="button" data-cmc="9">9</button>
          <button class="mana-step" type="button" data-cmc="10+">10+</button>
        </div>
        <div class="mana-rango-info">
          <span id="manaRangoTexto" class="hint">Sin rango de coste.</span>
          <button id="btnLimpiarManaRango" class="btn-secundario" type="button">Limpiar rango</button>
        </div>
      </div>

      <div class="filtro-bloque">
        <label for="inputRulingCommander">Texto en ruling:</label>
        <input id="inputRulingCommander" type="text" placeholder="Ej: draw a card, lifelink..." />
        <small class="hint">Busca palabras dentro del texto de reglas.</small>
      </div>

      <div class="acciones-verticales commander-actions">
        <button id="btnBuscarComandantes" class="btn-principal" type="button">Buscar</button>
        <button id="btnLuckyCommander" class="btn-secundario" type="button">Voy a tener suerte</button>
      </div>
    </div>

    <div id="resultadosComandantes"></div>
  </section>

    <!-- =======================
       PANTALLA: DECKS
  ======================= -->
  <section id="pantallaDecks" class="pantalla">
    <div class="topbar">
      <img src="icons/flecharegresar.png" class="btn-back" data-action="volverMenu" aria-label="Volver al menú" alt="Volver" />
      <h2>Decks</h2>
    </div>

    <div id="listaDecks"></div>

    <div class="card">
      <button id="btnAgregarDeck" class="btn-principal" type="button" style="width: 100%;">+ Agregar Deck</button>
    </div>
  </section>

  <!-- Modal Agregar Deck -->
  <div id="modalAgregarDeck" class="modal-overlay" style="display:none;">
    <div class="modal-content">
      <h3>Agregar Deck</h3>
      
      <label for="inputNombreDeck">Nombre del Deck:</label>
      <input id="inputNombreDeck" type="text" placeholder="Ej: Mi Mazo Commander" />
      
      <label for="textareaListaDeck" style="margin-top: 15px;">Lista de cartas (formato Moxfield):</label>
      <textarea id="textareaListaDeck" rows="10" placeholder="1 Argonath, Pillars of the Kings (LTC) 351&#10;1 Sol Ring (C21) 263&#10;..." style="width: 100%; font-family: monospace; font-size: 0.9rem;"></textarea>
      
      <div id="mensajeCargandoDeck" style="display: none; margin-top: 15px; padding: 12px; background: #e3f2fd; border-radius: 8px; text-align: center; color: #1976d2;">
        <strong>⏳ Verificando cartas...</strong><br>
        <small>Esto puede tardar unos segundos</small>
      </div>
      
      <div style="display: flex; gap: 10px; margin-top: 20px;">
        <button id="btnGuardarDeck" class="btn-principal">Guardar</button>
        <button id="btnCancelarDeck" class="btn-secundario">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- Pantalla Ver Deck -->
  <section id="pantallaVerDeck" class="pantalla">
    <div class="topbar">
      <img src="icons/flecharegresar.png" class="btn-back" data-action="volverDecks" aria-label="Volver" alt="Volver" />
      <h2 id="tituloVerDeck">Deck</h2>
    </div>

    <div class="card">
      <div id="resumenDeck" class="hint"></div>
      <div style="display: flex; gap: 10px; align-items: center; margin-top: 15px; flex-wrap: wrap;">
        <button id="btnActualizarDeck" class="btn-secundario" type="button">Revisar colección</button>
        <button id="btnCompletarMazo" class="btn-secundario" type="button">Completar mazo ❗</button>
      </div>
      <div id="mensajeCargandoDeck" style="display: none; margin-top: 15px; padding: 12px; background: #e3f2fd; border-radius: 8px; text-align: center; color: #1976d2;">
        <strong>⏳ Cargando información del deck...</strong><br>
        <small>Esto puede tardar unos segundos</small>
      </div>
      <div id="mensajeCompletandoMazo" style="display: none; margin-top: 15px; padding: 12px; background: #e3f2fd; border-radius: 8px; text-align: center; color: #1976d2;">
        <strong>⏳ Agregando cartas a la colección...</strong><br>
        <small>Esto puede tardar unos segundos</small>
      </div>
      <div id="mensajeCargandoImagenesDeck" style="display: none; margin-top: 15px; padding: 12px; background: #e3f2fd; border-radius: 8px; text-align: center; color: #1976d2;">
        <strong>⏳ Cargando imágenes...</strong><br>
        <small>Esto puede tardar unos segundos</small>
      </div>
    </div>

    <!-- Modo de visualización -->
    <div class="card">
      <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
        <div style="display: flex; gap: 10px; align-items: center;">
          <span style="font-weight: 600;">Vista:</span>
          <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
            <input type="radio" name="modoDeck" value="lista" id="radioModoDeckLista" checked>
            <span>Lista</span>
          </label>
          <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
            <input type="radio" name="modoDeck" value="imagenes" id="radioModoDeckImagenes">
            <span>Imágenes</span>
          </label>
        </div>
        <div style="display: flex; gap: 10px; align-items: center;">
          <span style="font-weight: 600;">Ordenar:</span>
          <select id="selectorOrdenDeck" style="padding: 5px 10px; border-radius: 6px; border: 1px solid #ccc;">
            <option value="default">Por defecto</option>
            <option value="tipo">Por tipo</option>
            <option value="cmc">Por coste (CMC)</option>
            <option value="color">Por color</option>
            <option value="nombre">Por nombre</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Leyenda de LEDs -->
    <div class="card">
      <h4 style="margin-top: 0; margin-bottom: 10px;">Leyenda</h4>
      <div style="display: flex; flex-direction: column; gap: 8px;">
        <div style="display: flex; align-items: center; gap: 10px;">
          <img src="icons/Ledazul.png" alt="" width="24" height="24">
          <span>En posesión</span>
        </div>
        <div style="display: flex; align-items: center; gap: 10px;">
          <img src="icons/Ledrojo.png" alt="" width="24" height="24">
          <span>Falta</span>
        </div>
        <div style="display: flex; align-items: center; gap: 10px;">
          <img src="icons/Ledvioleta.png" alt="" width="24" height="24">
          <span>En posesión en otro set</span>
        </div>
      </div>
    </div>

    <div class="card">
      <div id="listaCartasDeck"></div>
    </div>

    <div class="card">
      <div id="mensajeEliminandoCartas" style="display: none; margin-bottom: 15px; padding: 12px; background: #fff3cd; border-radius: 8px; text-align: center; color: #856404;">
        <strong>⏳ Verificando cartas para eliminar...</strong><br>
        <small>Esto puede tardar unos segundos</small>
      </div>
      <button id="btnEliminarDeck" class="btn-secundario" type="button" style="width: 100%; background: #dc3545;">Eliminar Deck</button>
    </div>
  </section>

    <!-- =======================
       PANTALLA: ESTADÍSTICAS
  ======================= -->
  <section id="pantallaEstadisticas" class="pantalla">
    <div class="topbar">
      <img src="icons/flecharegresar.png" class="btn-back" data-action="volverMenu" aria-label="Volver al menú" alt="Volver" />
      <h2>Estadísticas</h2>
    </div>

    <div class="card">
      <h3 style="margin-top:0;">Resumen</h3>
      <div id="statsResumen" class="hint">—</div>
      <div style="height:10px;"></div>
      <button id="btnStatsRecalcular" class="btn-secundario" type="button">Recalcular</button>
    </div>

    <div class="card">
      <h3 style="margin-top:0;">Sets</h3>
      <div id="statsSets" class="hint">—</div>
    </div>
  </section>

    <!-- =======================
       PANTALLA: CUENTA
  ======================= -->
  <section id="pantallaCuenta" class="pantalla">
    <div class="topbar">
      <img src="icons/flecharegresar.png" class="btn-back" data-action="volverMenu" aria-label="Volver al menú" alt="Volver" />
      <h2>Cuenta</h2>
    </div>

  <!-- (Tema eliminado: la aplicación usa tema claro por defecto) -->

    <!-- Login + Sync (ÚNICO, sin duplicados) -->
    <div class="card card-small">
      <h3 style="margin-top:0; font-size:1rem;">Cuenta y sincronización</h3>

      <div class="fila">
        <input id="inputEmail" type="text" placeholder="tu@email.com" />
        <button id="btnLogin" class="btn-principal" type="button">Entrar</button>
      </div>

      <div class="acciones-verticales" style="margin-top:10px;">
        <button id="btnPushNow" class="btn-secundario" type="button">Guardar</button>
        <button id="btnLogout" class="btn-secundario" type="button">Salir</button>
      </div>

      <p id="syncStatus" class="hint" style="margin-top:10px;"></p>
    </div>

    <!-- Backup JSON (ÚNICO, sin duplicados) -->
    <div class="card card-small">
      <h3 style="margin-top:0; font-size:1rem;">Copia de seguridad</h3>
      <p class="hint" style="font-size:0.85rem;">Exporta tu colección a un archivo JSON o impórtala desde uno.</p>

      <div class="acciones-verticales">
        <button id="btnExportarEstado" class="btn-principal" type="button">Exportar</button>
        <input id="inputImportarEstado" type="file" accept="application/json" style="display:none;" />
        <button id="btnImportarEstado" class="btn-secundario" type="button">Importar</button>
      </div>

      <p id="msgBackup" class="hint" style="margin-top:10px;"></p>
    </div>

    <!-- Catálogo de sets -->
    <div class="card card-small">
      <h3 style="margin-top:0; font-size:1rem;">Catálogo de sets</h3>
      <p class="hint" style="font-size:0.85rem;">Actualiza la lista de colecciones disponibles desde Scryfall.</p>

      <div class="acciones-verticales">
        <button id="btnActualizarCatalogo" class="btn-principal" type="button" style="width: 100%; padding: 14px; font-size: 1.1rem; cursor: pointer; border-radius: 10px; border: none; font-weight: bold; background: linear-gradient(180deg, rgba(122,166,255,.45), rgba(122,166,255,.18)) !important; border-color: rgba(122,166,255,.45) !important; box-shadow: 0 3px 8px rgba(47, 108, 255, 0.15), 0 1px 3px rgba(0, 0, 0, 0.08), inset 0 1px 0 rgba(255, 255, 255, 0.3) !important; color: var(--text) !important; transition: all 0.2s ease;">Actualizar catálogo</button>
      </div>

      <p id="msgCatalogo" class="hint" style="margin-top:10px;"></p>
      <p id="fechaCatalogo" class="hint" style="margin-top:5px; font-size:0.8rem; opacity:0.7;"></p>
    </div>

    <!-- Atribución Scryfall -->
    <div class="card" style="text-align:center; opacity:0.85;">
      <p class="hint" style="margin:0;">
        Datos de cartas proporcionados por Scryfall.<br>
        © Scryfall, LLC · <a href="https://scryfall.com" target="_blank" rel="noopener">scryfall.com</a>
      </p>
    </div>

    <!-- Versión de la app -->
    <div style="text-align:center; margin-top:20px; opacity:0.6;">
      <p class="hint" style="margin:0; font-size:0.75rem;">
        ManaCodex v0.8
      </p>
    </div>
 
  </section>

  <!-- =======================
       MODAL: CARTA
  ======================= -->
  <div id="modalCarta" class="modal hidden" role="dialog" aria-modal="true">
    <div class="modal-backdrop" data-action="cerrarModal"></div>

    <div class="modal-content">
      <div class="modal-topbar">
        <div id="modalCartaTitulo" class="modal-title">Carta</div>
        <button id="btnCerrarModal" class="btn-secundario" type="button">✕</button>
      </div>

      <div id="modalCartaBody" class="modal-body"></div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <!-- Botón flotante scroll to top (único y global) -->
  <button id="btnScrollTop" aria-label="Volver arriba">↑</button>

  <script src="./app.js?v=0.82"></script>
</body>
</html>
